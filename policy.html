<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Profit Protection Demo â€” Policy Settings</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 text-slate-900">
<script>
  const POLICY_KEY = "pp_demo_policy";

  const DEFAULT_POLICY = {
    minVariationMarginPct: 15,      // variation margin floor (% of charge)
    projectDriftTolerancePct: 1.0,  // allowed drop vs target margin (% points)
    portfolioDriftTolerancePct: 1.0,// allowed drop vs target portfolio margin (% points)
    exposureThreshold: 20000        // optional (AUD), for future alerts
  };

  function loadPolicy() {
    try {
      const raw = localStorage.getItem(POLICY_KEY);
      if (!raw) return structuredClone(DEFAULT_POLICY);
      const p = JSON.parse(raw);
      return {
        ...structuredClone(DEFAULT_POLICY),
        ...p
      };
    } catch {
      return structuredClone(DEFAULT_POLICY);
    }
  }

  function savePolicy(p) {
    localStorage.setItem(POLICY_KEY, JSON.stringify(p));
  }

  function resetPolicy() {
    savePolicy(structuredClone(DEFAULT_POLICY));
    location.reload();
  }

  const policy = loadPolicy();

  function onSave(e) {
    e.preventDefault();
    const p = {
      minVariationMarginPct: Number(document.getElementById("minVar").value || DEFAULT_POLICY.minVariationMarginPct),
      projectDriftTolerancePct: Number(document.getElementById("projTol").value || DEFAULT_POLICY.projectDriftTolerancePct),
      portfolioDriftTolerancePct: Number(document.getElementById("portTol").value || DEFAULT_POLICY.portfolioDriftTolerancePct),
      exposureThreshold: Number(document.getElementById("expo").value || DEFAULT_POLICY.exposureThreshold)
    };
    savePolicy(p);
    const msg = document.getElementById("saved");
    msg.classList.remove("hidden");
    msg.textContent = "Saved. These rules will apply across the demo on refresh.";
    setTimeout(() => msg.classList.add("hidden"), 2500);
  }
</script>

<header class="border-b bg-white">
  <div class="mx-auto max-w-4xl px-4 py-4 flex items-center justify-between">
    <div>
      <div class="text-xl font-semibold">Profit Protection System</div>
      <div class="text-sm text-slate-600">Policy Settings (demo)</div>
    </div>
    <div class="flex gap-2">
      <a href="index.html" class="px-3 py-2 rounded-lg bg-white border text-sm">Portfolio</a>
      <a href="project.html" class="px-3 py-2 rounded-lg bg-white border text-sm">Project</a>
      <a href="pitch.html" class="px-3 py-2 rounded-lg bg-white border text-sm">Pitch Mode</a>
      <button onclick="resetPolicy()" class="px-3 py-2 rounded-lg bg-white border text-sm">Reset Policy</button>
    </div>
  </div>
</header>

<main class="mx-auto max-w-4xl px-4 py-6">
  <div class="rounded-2xl bg-white border p-5">
    <div class="text-lg font-semibold">Financial Control Rules</div>
    <div class="text-sm text-slate-600 mt-1">These are director-level guardrails. Alerts in the demo use these thresholds.</div>

    <form class="mt-5 space-y-4" onsubmit="onSave(event)">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="rounded-xl bg-slate-50 border p-4">
          <label class="text-sm font-medium text-slate-700">Minimum variation margin (%)</label>
          <div class="text-xs text-slate-500 mt-1">If a variation margin is below this, show a warning.</div>
          <input id="minVar" type="number" step="0.1" class="mt-3 w-full rounded-lg border px-3 py-2 text-sm"
                 value="">
        </div>

        <div class="rounded-xl bg-slate-50 border p-4">
          <label class="text-sm font-medium text-slate-700">Project drift tolerance (% points)</label>
          <div class="text-xs text-slate-500 mt-1">If current margin is lower than target by more than this, show a red banner.</div>
          <input id="projTol" type="number" step="0.1" class="mt-3 w-full rounded-lg border px-3 py-2 text-sm"
                 value="">
        </div>

        <div class="rounded-xl bg-slate-50 border p-4">
          <label class="text-sm font-medium text-slate-700">Portfolio drift tolerance (% points)</label>
          <div class="text-xs text-slate-500 mt-1">If portfolio margin is lower than target by more than this, show a red banner.</div>
          <input id="portTol" type="number" step="0.1" class="mt-3 w-full rounded-lg border px-3 py-2 text-sm"
                 value="">
        </div>

        <div class="rounded-xl bg-slate-50 border p-4">
          <label class="text-sm font-medium text-slate-700">Exposure threshold (AUD)</label>
          <div class="text-xs text-slate-500 mt-1">Optional. Used to flag high unapproved exposure (Phase 2).</div>
          <input id="expo" type="number" step="1" class="mt-3 w-full rounded-lg border px-3 py-2 text-sm"
                 value="">
        </div>
      </div>

      <div id="saved" class="hidden rounded-xl border border-emerald-200 bg-emerald-50 p-3 text-emerald-700 text-sm"></div>

      <div class="flex items-center justify-between pt-2">
        <div class="text-xs text-slate-500">
          Demo note: these rules are stored in your browser (localStorage).
        </div>
        <button class="px-4 py-2 rounded-lg bg-slate-900 text-white text-sm">Save Policy</button>
      </div>
    </form>
  </div>

  <script>
    // set values
    document.getElementById("minVar").value = policy.minVariationMarginPct;
    document.getElementById("projTol").value = policy.projectDriftTolerancePct;
    document.getElementById("portTol").value = policy.portfolioDriftTolerancePct;
    document.getElementById("expo").value = policy.exposureThreshold;
  </script>
</main>
</body>
</html>